# 常用旅客自动替换空白栏 - 测试说明

## 📋 功能说明

**优化内容:** 在航班预订页面选择常用旅客后,系统会自动替换空白的旅客表单,无需手动删除。

**修复问题:** #011 - 选择常用旅客后空白栏未自动删除

---

## 🧪 测试步骤

### 场景1: 初次添加常用旅客(有空白栏)

1. **进入航班预订页面**
   - 导航到: `/user/flight-book/:flightId`
   - 确认页面显示一个空白的旅客表单

2. **点击"选择常用旅客"按钮**
   - 位置: 乘客信息区域右上角
   - 图标: 👥 选择常用旅客

3. **选择一个常用旅客**
   - 在弹窗中点击任意一个常用旅客

4. **验证结果** ✅
   - 空白旅客表单被常用旅客信息替换
   - 旅客列表中只有1个旅客(已填充信息)
   - **不需要**手动点击删除按钮

---

### 场景2: 继续添加第二个常用旅客(无空白栏)

1. **在场景1的基础上**
   - 已有1个填充好的旅客信息

2. **再次点击"选择常用旅客"**
   - 选择另一个常用旅客

3. **验证结果** ✅
   - 第二个旅客被添加到列表末尾
   - 旅客列表中有2个旅客(都已填充信息)
   - 没有空白表单

---

### 场景3: 手动填写后再添加常用旅客

1. **进入航班预订页面**
   - 默认显示一个空白旅客表单

2. **在空白表单中填写部分信息**
   - 例如: 只填写姓名,不填写证件号和手机号

3. **点击"选择常用旅客"**
   - 选择一个常用旅客

4. **验证结果** ✅
   - 因为空白表单已有部分内容,不会被替换
   - 常用旅客被添加为第二个旅客
   - 旅客列表中有2个旅客

---

### 场景4: 完全空白表单的判断逻辑

**空白表单的定义:**
- 姓名为空(去除空格后)
- 证件号为空(去除空格后)
- 手机号为空(去除空格后)

**测试用例:**

| 姓名 | 证件号 | 手机号 | 是否为空白 | 是否被替换 |
|------|--------|--------|-----------|-----------|
| 空 | 空 | 空 | ✅ 是 | ✅ 会 |
| "张三" | 空 | 空 | ❌ 否 | ❌ 不会 |
| 空 | "123456" | 空 | ❌ 否 | ❌ 不会 |
| 空 | 空 | "13800138000" | ❌ 否 | ❌ 不会 |
| "  " | "  " | "  " | ✅ 是 | ✅ 会 |

---

## 🎯 预期行为总结

### 优化前
```
初始状态: [空白表单]
选择常用旅客后: [空白表单, 常用旅客1]
需要手动删除: [常用旅客1] ← 用户需要点击删除按钮
```

### 优化后
```
初始状态: [空白表单]
选择常用旅客后: [常用旅客1] ← 自动替换,无需手动删除
```

---

## 💡 技术实现

### 核心逻辑

```typescript
// 检查是否存在空白旅客栏
const emptyPassengerIndex = passengers.value.findIndex(p => 
  !p.name.trim() && !p.idCard.trim() && !p.phone.trim()
)

if (emptyPassengerIndex !== -1) {
  // 替换空白旅客栏
  passengers.value[emptyPassengerIndex] = newPassenger
} else {
  // 添加新旅客
  passengers.value.push(newPassenger)
}
```

### 关键点
- ✅ 使用 `trim()` 去除空格,避免误判
- ✅ 检查三个关键字段: 姓名、证件号、手机号
- ✅ 只替换**完全空白**的表单
- ✅ 保留用户已填写的部分信息

---

## ✅ 验收标准

- [ ] 初次选择常用旅客时,空白表单被自动替换
- [ ] 继续添加常用旅客时,正常添加到列表末尾
- [ ] 部分填写的表单不会被替换
- [ ] 完全空白的表单(包括只有空格)会被替换
- [ ] 不影响手动添加旅客功能
- [ ] 不影响删除旅客功能

---

## 🐛 可能的边界情况

### 1. 多个空白表单
**场景:** 用户手动添加了多个空白表单  
**行为:** 只替换第一个空白表单  
**原因:** 使用 `findIndex` 返回第一个匹配项

### 2. 达到最大乘客数
**场景:** 已有9个乘客(最大数量)  
**行为:** 提示"已达到最大乘客数量",不执行任何操作  
**验证:** ✅ 正常

### 3. 空格字符
**场景:** 表单中只有空格字符  
**行为:** 视为空白表单,会被替换  
**原因:** 使用 `trim()` 处理

---

## 📊 用户体验提升

### 优化前
- ❌ 需要3步操作: 选择常用旅客 → 关闭弹窗 → 删除空白表单
- ❌ 容易忘记删除空白表单
- ❌ 提交时可能因空白表单验证失败

### 优化后
- ✅ 只需2步操作: 选择常用旅客 → 关闭弹窗
- ✅ 自动处理,无需关注
- ✅ 列表保持简洁

---

## 📝 测试记录

| 测试场景 | 测试日期 | 测试结果 | 备注 |
|---------|---------|---------|------|
| 场景1: 初次添加 | 2025-11-10 | ⏳ 待测试 | |
| 场景2: 继续添加 | 2025-11-10 | ⏳ 待测试 | |
| 场景3: 部分填写 | 2025-11-10 | ⏳ 待测试 | |
| 场景4: 边界情况 | 2025-11-10 | ⏳ 待测试 | |

---

## 🔗 相关文档

- **修复记录:** `project-testing-and-fixes.md` - #011
- **开发记录:** `开发记录.md`
- **源代码:** `src/views/user/FlightBookPage.vue` (第627-657行)

---

**测试负责人:** _____________  
**测试日期:** 2025-11-10  
**文档版本:** v1.0
