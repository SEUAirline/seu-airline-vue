# Mock æ•°æ®é…ç½®æŒ‡å—

**é…ç½®æ—¶é—´:** 2025-10-23  
**æ’ä»¶:** vite-plugin-mock + mockjs

---

## ğŸ“¦ å·²å®‰è£…çš„ä¾èµ–

```bash
npm install -D vite-plugin-mock mockjs
```

- **vite-plugin-mock:** Vite çš„ Mock æ•°æ®æ’ä»¶
- **mockjs:** ç”Ÿæˆéšæœºæ•°æ®çš„å·¥å…·åº“

---

## âš™ï¸ é…ç½®è¯´æ˜

### 1. Vite é…ç½®

**æ–‡ä»¶:** `vite.config.ts`

```typescript
import { viteMockServe } from 'vite-plugin-mock'

export default defineConfig({
  plugins: [
    vue(),
    viteMockServe({
      mockPath: 'mock',  // Mock æ–‡ä»¶ç›®å½•
      enable: true,      // å¯ç”¨ Mock
    })
  ],
  // ...
})
```

### 2. Mock æ–‡ä»¶ç»“æ„

```
mock/
â”œâ”€â”€ flight.ts    # èˆªç­ç›¸å…³ Mock æ•°æ®
â”œâ”€â”€ user.ts      # ç”¨æˆ·ç›¸å…³ Mock æ•°æ®
â””â”€â”€ order.ts     # è®¢å•ç›¸å…³ Mock æ•°æ®
```

---

## ğŸ›« èˆªç­ Mock API

**æ–‡ä»¶:** `mock/flight.ts`

### å¯ç”¨æ¥å£

#### 1. æœç´¢èˆªç­
```
GET /api/v1/flight/search
å‚æ•°: departureCity, arrivalCity, departureDate
```

**åŠŸèƒ½:**
- è‡ªåŠ¨ç”Ÿæˆ 15-30 ä¸ªéšæœºèˆªç­
- åŒ…å«å¤šä¸ªèˆªç©ºå…¬å¸
- éšæœºä»·æ ¼ã€æ—¶é—´ã€åº§ä½æ•°
- æ”¯æŒä¸åŒçš„èˆªç­çŠ¶æ€

#### 2. è·å–èˆªç­è¯¦æƒ…
```
GET /api/v1/flight/:id
```

**åŠŸèƒ½:**
- æ ¹æ® ID è¿”å›å•ä¸ªèˆªç­è¯¦æƒ…

#### 3. è·å–æœºåœºåˆ—è¡¨
```
GET /api/v1/airport/list
```

**åŠŸèƒ½:**
- è¿”å› 10 ä¸ªåŸå¸‚çš„æœºåœºä¿¡æ¯
- åŒ…å«æœºåœºä»£ç ã€åç§°ã€åŸå¸‚

#### 4. è·å–çƒ­é—¨èˆªçº¿
```
GET /api/v1/flight/popular
```

**åŠŸèƒ½:**
- è¿”å› 5 æ¡çƒ­é—¨èˆªçº¿

### Mock æ•°æ®ç‰¹ç‚¹

**èˆªç©ºå…¬å¸:**
- ä¸­å›½å›½é™…èˆªç©º (CA)
- ä¸­å›½ä¸œæ–¹èˆªç©º (MU)
- ä¸­å›½å—æ–¹èˆªç©º (CZ)
- æµ·å—èˆªç©º (HU)
- å¦é—¨èˆªç©º (MF)
- å››å·èˆªç©º (SC)
- æ·±åœ³èˆªç©º (ZH)

**æ”¯æŒçš„åŸå¸‚:**
- åŒ—äº¬ã€ä¸Šæµ·ã€å¹¿å·ã€æ·±åœ³ã€æˆéƒ½
- æ­å·ã€è¥¿å®‰ã€é‡åº†ã€å¦é—¨ã€å—äº¬

**èˆªç­æ•°æ®åŒ…å«:**
- èˆªç­å·ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
- èµ·é£/åˆ°è¾¾æ—¶é—´ï¼ˆéšæœºç”Ÿæˆï¼‰
- é£è¡Œæ—¶é•¿ï¼ˆ1-4å°æ—¶ï¼‰
- ä»·æ ¼ï¼ˆ400-2000å…ƒï¼‰
- åº§ä½æ•°ï¼ˆç»æµèˆ±ã€å•†åŠ¡èˆ±ã€å¤´ç­‰èˆ±ï¼‰
- èˆªç­çŠ¶æ€ï¼ˆå‡†ç‚¹/å»¶è¯¯ï¼‰
- æœºå‹ï¼ˆA320ã€B737ç­‰ï¼‰

---

## ğŸ‘¤ ç”¨æˆ· Mock API

**æ–‡ä»¶:** `mock/user.ts`

### å¯ç”¨æ¥å£

#### 1. ç”¨æˆ·æ³¨å†Œ
```
POST /api/v1/auth/register
Body: { username, password, email, phone }
```

#### 2. ç”¨æˆ·ç™»å½•
```
POST /api/v1/auth/login
Body: { username, password }
```

**æµ‹è¯•è´¦å·:**
- ç”¨æˆ·å: `user001`
- å¯†ç : `123456`

#### 3. è·å–ç”¨æˆ·ä¿¡æ¯
```
GET /api/v1/user/profile
Headers: Authorization: Bearer {token}
```

#### 4. æ›´æ–°ç”¨æˆ·ä¿¡æ¯
```
PUT /api/v1/user/profile
Body: { email, phone, realName }
```

#### 5. ä¿®æ”¹å¯†ç 
```
PUT /api/v1/user/password
Body: { oldPassword, newPassword }
```

---

## ğŸ“‹ è®¢å• Mock API

**æ–‡ä»¶:** `mock/order.ts`

### å¯ç”¨æ¥å£

#### 1. åˆ›å»ºè®¢å•
```
POST /api/v1/order
Body: { flightId, passengers, contactName, contactPhone, totalPrice }
```

**åŠŸèƒ½:**
- è‡ªåŠ¨ç”Ÿæˆè®¢å•å·
- è®¢å•çŠ¶æ€é»˜è®¤ä¸º"å¾…æ”¯ä»˜"

#### 2. è·å–è®¢å•åˆ—è¡¨
```
GET /api/v1/order/list
å‚æ•°: status, page, pageSize
```

**è®¢å•çŠ¶æ€:**
- 1: å¾…æ”¯ä»˜
- 2: å·²æ”¯ä»˜
- 3: å·²å–æ¶ˆ
- 4: å·²é€€æ¬¾

#### 3. è·å–è®¢å•è¯¦æƒ…
```
GET /api/v1/order/:id
```

#### 4. å–æ¶ˆè®¢å•
```
PUT /api/v1/order/:id/cancel
```

#### 5. æ”¯ä»˜è®¢å•
```
POST /api/v1/order/:id/pay
Body: { paymentMethod }
```

#### 6. ç”³è¯·é€€ç¥¨
```
POST /api/v1/order/:id/refund
Body: { reason }
```

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### 1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

### 2. æµ‹è¯•èˆªç­æœç´¢

1. æ‰“å¼€é¦–é¡µ `http://localhost:5173`
2. å¡«å†™æœç´¢è¡¨å•:
   - å‡ºå‘åœ°: åŒ—äº¬
   - ç›®çš„åœ°: ä¸Šæµ·
   - å‡ºå‘æ—¥æœŸ: é€‰æ‹©ä»Šå¤©æˆ–æœªæ¥æ—¥æœŸ
3. ç‚¹å‡»"æœç´¢èˆªç­"
4. **é¢„æœŸç»“æœ:** æ˜¾ç¤º 15-30 ä¸ªéšæœºç”Ÿæˆçš„èˆªç­

### 3. æŸ¥çœ‹ç½‘ç»œè¯·æ±‚

æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰:
1. åˆ‡æ¢åˆ° **Network** æ ‡ç­¾
2. æœç´¢èˆªç­
3. æŸ¥æ‰¾è¯·æ±‚: `search?departureCity=åŒ—äº¬&arrivalCity=ä¸Šæµ·...`
4. **é¢„æœŸç»“æœ:** çŠ¶æ€ç  200ï¼Œè¿”å›èˆªç­æ•°æ®

### 4. æµ‹è¯•ç”¨æˆ·ç™»å½•

1. è®¿é—®ç™»å½•é¡µé¢ `/login`
2. è¾“å…¥æµ‹è¯•è´¦å·:
   - ç”¨æˆ·å: `user001`
   - å¯†ç : `123456`
3. ç‚¹å‡»ç™»å½•
4. **é¢„æœŸç»“æœ:** ç™»å½•æˆåŠŸï¼Œè·å¾— Token

---

## ğŸ” è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹ Mock æ—¥å¿—

Mock æ’ä»¶ä¼šåœ¨æ§åˆ¶å°è¾“å‡ºæ‹¦æˆªçš„è¯·æ±‚:

```
[vite:mock-server] request invoke: /api/v1/flight/search
```

### æ£€æŸ¥ Mock æ˜¯å¦ç”Ÿæ•ˆ

1. æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°
2. æŸ¥çœ‹ Network æ ‡ç­¾
3. è¯·æ±‚åº”è¯¥è¢« Mock æ‹¦æˆªï¼Œè¿”å›æ¨¡æ‹Ÿæ•°æ®
4. å“åº”å¤´ä¼šåŒ…å« `X-Powered-By: vite-plugin-mock`

### å¸¸è§é—®é¢˜

#### Q1: Mock ä¸ç”Ÿæ•ˆ
**è§£å†³æ–¹æ¡ˆ:**
- æ£€æŸ¥ `vite.config.ts` é…ç½®æ˜¯å¦æ­£ç¡®
- ç¡®è®¤ `enable: true`
- é‡å¯å¼€å‘æœåŠ¡å™¨

#### Q2: è¯·æ±‚ 404
**è§£å†³æ–¹æ¡ˆ:**
- æ£€æŸ¥ API è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼ˆåº”è¯¥æ˜¯ `/api/v1/...`ï¼‰
- æ£€æŸ¥ Mock æ–‡ä»¶ä¸­çš„ URL é…ç½®

#### Q3: æ•°æ®æ ¼å¼é”™è¯¯
**è§£å†³æ–¹æ¡ˆ:**
- æ£€æŸ¥ Mock è¿”å›çš„æ•°æ®æ ¼å¼
- ç¡®ä¿ä¸ TypeScript ç±»å‹å®šä¹‰åŒ¹é…

---

## ğŸ“ Mock æ•°æ®ç¤ºä¾‹

### èˆªç­æœç´¢å“åº”

```json
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "success": true,
  "data": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "flightNo": "CA1234",
      "airline": "ä¸­å›½å›½é™…èˆªç©º",
      "departureAirport": "PEK",
      "arrivalAirport": "PVG",
      "departureCity": "åŒ—äº¬",
      "arrivalCity": "ä¸Šæµ·",
      "departureTime": "2025-10-24T08:30:00.000Z",
      "arrivalTime": "2025-10-24T10:45:00.000Z",
      "date": "2025-10-24",
      "duration": "2å°æ—¶15åˆ†é’Ÿ",
      "price": 850,
      "economySeats": 120,
      "businessSeats": 20,
      "firstClassSeats": 8,
      "status": "scheduled",
      "aircraft": "A320"
    }
  ]
}
```

### ç”¨æˆ·ç™»å½•å“åº”

```json
{
  "code": 200,
  "message": "ç™»å½•æˆåŠŸ",
  "success": true,
  "data": {
    "token": "550e8400-e29b-41d4-a716-446655440000",
    "user": {
      "id": 1,
      "username": "user001",
      "email": "user001@example.com",
      "phone": "13800138000",
      "realName": "å¼ ä¸‰",
      "memberLevel": 2,
      "points": 1500
    }
  }
}
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥

Mock æ•°æ®é…ç½®å®Œæˆåï¼Œä½ å¯ä»¥:

1. âœ… **æµ‹è¯•èˆªç­æœç´¢åŠŸèƒ½** - å®Œæ•´çš„æœç´¢ã€ç­›é€‰ã€æ’åºæµç¨‹
2. âœ… **æµ‹è¯•ç”¨æˆ·ç™»å½•** - æ³¨å†Œã€ç™»å½•ã€è·å–ä¿¡æ¯
3. â³ **å¼€å‘èˆªç­é¢„è®¢åŠŸèƒ½** - ä½¿ç”¨è®¢å• Mock API
4. â³ **å¼€å‘æ”¯ä»˜åŠŸèƒ½** - ä½¿ç”¨è®¢å•æ”¯ä»˜ Mock API
5. â³ **å¼€å‘è®¢å•ç®¡ç†** - ä½¿ç”¨è®¢å•åˆ—è¡¨ Mock API

---

## ğŸ’¡ æç¤º

### Mock æ•°æ®çš„ä¼˜åŠ¿

1. **ç‹¬ç«‹å¼€å‘** - å‰ç«¯ä¸ä¾èµ–åç«¯è¿›åº¦
2. **å¿«é€Ÿæµ‹è¯•** - æ— éœ€ç­‰å¾…çœŸå® API
3. **å¯æ§æ•°æ®** - å¯ä»¥æ¨¡æ‹Ÿå„ç§åœºæ™¯
4. **ç¦»çº¿å¼€å‘** - æ— éœ€ç½‘ç»œè¿æ¥

### æ³¨æ„äº‹é¡¹

1. Mock æ•°æ®ä»…åœ¨å¼€å‘ç¯å¢ƒæœ‰æ•ˆ
2. ç”Ÿäº§ç¯å¢ƒéœ€è¦åˆ‡æ¢åˆ°çœŸå® API
3. Mock æ•°æ®ä¸ä¼šæŒä¹…åŒ–ï¼ˆåˆ·æ–°é¡µé¢ä¼šé‡ç½®ï¼‰
4. è®¢å•æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­

---

## ğŸ”„ åˆ‡æ¢åˆ°çœŸå® API

å½“åç«¯ API å¼€å‘å®Œæˆåï¼Œåªéœ€:

1. ä¿®æ”¹ `vite.config.ts`:
```typescript
viteMockServe({
  mockPath: 'mock',
  enable: false,  // å…³é—­ Mock
})
```

2. æˆ–è€…ä½¿ç”¨ç¯å¢ƒå˜é‡:
```typescript
viteMockServe({
  mockPath: 'mock',
  enable: import.meta.env.MODE === 'development',
})
```

---

**é…ç½®å®Œæˆï¼** ğŸ‰

ç°åœ¨ä½ å¯ä»¥å¼€å§‹æµ‹è¯•èˆªç­æœç´¢åŠŸèƒ½äº†ã€‚ç¥å¼€å‘é¡ºåˆ©ï¼
