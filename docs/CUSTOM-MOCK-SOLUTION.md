# è‡ªå®šä¹‰ Mock è§£å†³æ–¹æ¡ˆ

**é—®é¢˜:** vite-plugin-mock æ— æ³•æ­£å¸¸å·¥ä½œ  
**è§£å†³æ–¹æ¡ˆ:** ä½¿ç”¨ Vite è‡ªå®šä¹‰ä¸­é—´ä»¶å®ç° Mock  
**æ—¶é—´:** 2025-11-06 21:20

---

## âœ… å·²å®ç°

æ›¿æ¢äº† `vite-plugin-mock`ï¼Œä½¿ç”¨ Vite çš„è‡ªå®šä¹‰ä¸­é—´ä»¶ç›´æ¥æ‹¦æˆª API è¯·æ±‚ã€‚

### ä¼˜åŠ¿

1. **ä¸ä¾èµ–ç¬¬ä¸‰æ–¹æ’ä»¶** - ç›´æ¥ä½¿ç”¨ Vite å†…ç½®åŠŸèƒ½
2. **æ›´å¯æ§** - å®Œå…¨æŒæ¡ Mock é€»è¾‘
3. **è°ƒè¯•ç®€å•** - å¯ä»¥ç›´æ¥çœ‹åˆ°è¯·æ±‚æ‹¦æˆªæ—¥å¿—
4. **æ€§èƒ½æ›´å¥½** - æ— éœ€é¢å¤–çš„æ–‡ä»¶ç›‘å¬å’Œç¼–è¯‘

---

## ğŸš€ ç«‹å³æµ‹è¯•

### æ­¥éª¤1: é‡å¯æœåŠ¡å™¨

```bash
# åœæ­¢å½“å‰æœåŠ¡å™¨
Ctrl+C

# é‡æ–°å¯åŠ¨
npm run dev
```

### æ­¥éª¤2: æŸ¥çœ‹ç»ˆç«¯è¾“å‡º

**åº”è¯¥çœ‹åˆ°:**
```
=== Vite é…ç½® ===
æ¨¡å¼: development
å‘½ä»¤: serve
VITE_USE_MOCK: true
useMock: true

ğŸš€ è‡ªå®šä¹‰ Mock æ’ä»¶å·²å¯ç”¨  â† å¿…é¡»çœ‹åˆ°è¿™ä¸ªï¼

VITE v5.4.20  ready in XXX ms
```

### æ­¥éª¤3: æ‰“å¼€æµè§ˆå™¨

è®¿é—® http://localhost:5173

**ç»ˆç«¯åº”è¯¥æ˜¾ç¤º:**
```
ğŸ“¡ æ‹¦æˆªè¯·æ±‚: /api/airport/list
ğŸ“¡ æ‹¦æˆªè¯·æ±‚: /api/messages/unread-count
```

### æ­¥éª¤4: æŸ¥çœ‹æµè§ˆå™¨ Console

**åº”è¯¥çœ‹åˆ°:**
```
Flight Store: API å“åº”: {code: 200, message: "æŸ¥è¯¢æˆåŠŸ", data: Array(10), success: true}
æœºåœºæ•°é‡: 10
åŸå¸‚æ•°é‡: 10
```

---

## ğŸ“Š å·¥ä½œåŸç†

```
å‰ç«¯è¯·æ±‚ /api/airport/list
    â†“
Vite å¼€å‘æœåŠ¡å™¨
    â†“
è‡ªå®šä¹‰ä¸­é—´ä»¶æ‹¦æˆª
    â†“
æ£€æŸ¥ req.url
    â†“
åŒ¹é… /api/airport/list
    â†“
è¿”å› JSON æ•°æ®
    â†“
å‰ç«¯æ¥æ”¶æ•°æ®
```

---

## ğŸ”§ å½“å‰å®ç°çš„ API

### 1. æœºåœºåˆ—è¡¨
- **è·¯å¾„:** `/api/airport/list`
- **æ–¹æ³•:** GET
- **è¿”å›:** 10 ä¸ªæœºåœºæ•°æ®

### 2. æµ‹è¯• API
- **è·¯å¾„:** `/api/test`
- **æ–¹æ³•:** GET
- **è¿”å›:** Mock æµ‹è¯•æ•°æ®

---

## ğŸ“ ä¸‹ä¸€æ­¥ï¼šæ·»åŠ æ›´å¤š API

éœ€è¦åœ¨ `vite.config.ts` çš„ä¸­é—´ä»¶ä¸­æ·»åŠ æ›´å¤š API Mockï¼š

```typescript
server.middlewares.use(async (req, res, next) => {
  if (req.url?.startsWith('/api/')) {
    console.log('ğŸ“¡ æ‹¦æˆªè¯·æ±‚:', req.url)
    
    // æœºåœºåˆ—è¡¨
    if (req.url === '/api/airport/list') {
      res.setHeader('Content-Type', 'application/json')
      res.end(JSON.stringify({ ... }))
      return
    }
    
    // èˆªç­æœç´¢
    if (req.url?.startsWith('/api/flight/search')) {
      res.setHeader('Content-Type', 'application/json')
      res.end(JSON.stringify({ ... }))
      return
    }
    
    // æ·»åŠ æ›´å¤š API...
  }
  next()
})
```

---

## âœ… éªŒè¯æ¸…å•

**é‡å¯åæ£€æŸ¥:**

- [ ] ç»ˆç«¯æ˜¾ç¤º "ğŸš€ è‡ªå®šä¹‰ Mock æ’ä»¶å·²å¯ç”¨"
- [ ] æ‰“å¼€æµè§ˆå™¨åç»ˆç«¯æ˜¾ç¤º "ğŸ“¡ æ‹¦æˆªè¯·æ±‚: /api/airport/list"
- [ ] æµè§ˆå™¨ Console æ˜¾ç¤º "æœºåœºæ•°é‡: 10"
- [ ] ä¸‹æ‹‰æ¡†æ˜¾ç¤ºåŸå¸‚åˆ—è¡¨

---

## ğŸ¯ å¦‚æœæˆåŠŸ

**æ‚¨åº”è¯¥çœ‹åˆ°:**

1. **ç»ˆç«¯:** 
   - âœ… "ğŸš€ è‡ªå®šä¹‰ Mock æ’ä»¶å·²å¯ç”¨"
   - âœ… "ğŸ“¡ æ‹¦æˆªè¯·æ±‚: /api/airport/list"

2. **æµè§ˆå™¨ Console:**
   - âœ… "Flight Store: API å“åº”: {code: 200, ...}"
   - âœ… "æœºåœºæ•°é‡: 10"
   - âœ… "åŸå¸‚æ•°é‡: 10"

3. **é¡µé¢:**
   - âœ… ä¸‹æ‹‰æ¡†æ˜¾ç¤ºåŸå¸‚åˆ—è¡¨
   - âœ… å¯ä»¥é€‰æ‹©åŸå¸‚

---

**ç°åœ¨è¯·é‡å¯æœåŠ¡å™¨ï¼Œå¹¶å‘Šè¯‰æˆ‘æ˜¯å¦çœ‹åˆ°äº† "ğŸš€ è‡ªå®šä¹‰ Mock æ’ä»¶å·²å¯ç”¨"ï¼**
