# å¿«é€Ÿä¿®å¤æ€»ç»“

**æ—¶é—´:** 2025-11-06 20:47  
**é—®é¢˜:** æœç´¢æ ä¸‹æ‹‰æ¡†å’Œèˆªç­æœç´¢ç»“æœæ¶ˆå¤±

---

## âœ… å·²å®Œæˆçš„ä¿®å¤

### 1. API è·¯å¾„ç»Ÿä¸€ (å·²å®Œæˆ)
- âœ… ç§»é™¤æ‰€æœ‰å‰ç«¯ API çš„ `/api` å‰ç¼€
- âœ… ç§»é™¤æ‰€æœ‰ Mock API çš„ `/api` å‰ç¼€
- âœ… ç»Ÿä¸€ä½¿ç”¨ baseURL + ç›¸å¯¹è·¯å¾„

### 2. Mock API å“åº”æ ¼å¼ (éƒ¨åˆ†å®Œæˆ)
- âœ… message.ts æ·»åŠ  `success` å­—æ®µ
- âœ… flight.ts å·²æœ‰ `success` å­—æ®µ
- âœ… order.ts å·²æœ‰ `success` å­—æ®µ
- âœ… user.ts å·²æœ‰ `success` å­—æ®µ

---

## ğŸš€ ç«‹å³æ‰§è¡Œçš„æ­¥éª¤

### æ­¥éª¤1: é‡å¯å¼€å‘æœåŠ¡å™¨ (å¿…é¡»!)

```bash
# åœ¨ç»ˆç«¯æŒ‰ Ctrl+C åœæ­¢å½“å‰æœåŠ¡å™¨
# ç„¶åé‡æ–°å¯åŠ¨
npm run dev
```

**é‡è¦:** ç¯å¢ƒå˜é‡å’Œ Mock é…ç½®çš„æ›´æ”¹éœ€è¦é‡å¯æœåŠ¡å™¨æ‰èƒ½ç”Ÿæ•ˆï¼

---

### æ­¥éª¤2: éªŒè¯ Mock API æ˜¯å¦å¯ç”¨

æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼Œåº”è¯¥çœ‹åˆ°ï¼š

```
âœ… æ­£ç¡®çš„æ—¥å¿—:
[vite:mock] mock file change C:\...\mock\flight.ts
[vite:mock] mock file change C:\...\mock\message.ts

âŒ å¦‚æœçœ‹åˆ°è¿™äº›ï¼Œè¯´æ˜ Mock æœªå¯ç”¨:
[vite] http proxy error: /api/airport/list
ECONNREFUSED
```

---

### æ­¥éª¤3: æµ‹è¯•åŠŸèƒ½

1. **æµ‹è¯•æœºåœºåˆ—è¡¨**
   - æ‰“å¼€é¦–é¡µ
   - ç‚¹å‡»"å‡ºå‘åŸå¸‚"ä¸‹æ‹‰æ¡†
   - âœ… åº”è¯¥çœ‹åˆ°: åŒ—äº¬ã€ä¸Šæµ·ã€å¹¿å·ã€æ·±åœ³ã€æˆéƒ½ã€æ­å·ã€å—äº¬ã€è¥¿å®‰

2. **æµ‹è¯•èˆªç­æœç´¢**
   - é€‰æ‹©: å—äº¬ â†’ åŒ—äº¬
   - é€‰æ‹©æ—¥æœŸ: æ˜å¤©
   - ç‚¹å‡»æœç´¢
   - âœ… åº”è¯¥çœ‹åˆ°èˆªç­åˆ—è¡¨

---

## ğŸ” å¦‚æœè¿˜æ˜¯æ²¡æœ‰æ•°æ®

### æ£€æŸ¥æ¸…å•:

#### 1. ç¡®è®¤ Mock å·²å¯ç”¨
```bash
# æŸ¥çœ‹ .env.development
VITE_USE_MOCK=true  # å¿…é¡»æ˜¯ true
```

#### 2. ç¡®è®¤å·²é‡å¯æœåŠ¡å™¨
```bash
# å¿…é¡»å®Œå…¨åœæ­¢å¹¶é‡æ–°å¯åŠ¨
Ctrl+C
npm run dev
```

#### 3. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°
- æ‰“å¼€ F12 å¼€å‘è€…å·¥å…·
- æŸ¥çœ‹ Console æ ‡ç­¾
- æŸ¥çœ‹ Network æ ‡ç­¾

#### 4. æŸ¥çœ‹è¯·æ±‚è·¯å¾„
åœ¨ Network æ ‡ç­¾ä¸­ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
```
âœ… æ­£ç¡®:
/api/airport/list
/api/flight/search

âŒ é”™è¯¯:
/api/api/airport/list
```

---

## ğŸ“Š å½“å‰é…ç½®çŠ¶æ€

### ç¯å¢ƒå˜é‡ (.env.development)
```env
VITE_USE_MOCK=true  âœ…
```

### Vite é…ç½® (vite.config.ts)
```typescript
const useMock = env.VITE_USE_MOCK === 'true'

viteMockServe({
  enable: useMock,  // âœ… æ ¹æ®ç¯å¢ƒå˜é‡æ§åˆ¶
  logger: true      // âœ… æ˜¾ç¤ºæ—¥å¿—
})

proxy: useMock ? undefined : { ... }  // âœ… Mock å¯ç”¨æ—¶ç¦ç”¨ proxy
```

### API è·¯å¾„
```typescript
// å‰ç«¯ API
request.get('/airport/list')     // âœ… æ—  /api å‰ç¼€
request.get('/flight/search')    // âœ… æ—  /api å‰ç¼€

// Mock API
url: '/airport/list'             // âœ… æ—  /api å‰ç¼€
url: '/flight/search'            // âœ… æ—  /api å‰ç¼€

// æœ€ç»ˆè¯·æ±‚
baseURL + path = /api/airport/list  // âœ… æ­£ç¡®
```

---

## ğŸ¯ é¢„æœŸç»“æœ

### æ§åˆ¶å°æ—¥å¿—
```
[vite:mock] mock file change ...
```

### ç½‘ç»œè¯·æ±‚
```
Request URL: http://localhost:5173/api/airport/list
Status: 200 OK
Response Time: < 10ms (æå¿«ï¼Œè¯´æ˜æ˜¯ Mock)
```

### å“åº”æ•°æ®
```json
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": [
    { "code": "PEK", "name": "é¦–éƒ½å›½é™…æœºåœº", "city": "åŒ—äº¬" },
    { "code": "PVG", "name": "æµ¦ä¸œå›½é™…æœºåœº", "city": "ä¸Šæµ·" },
    ...
  ],
  "success": true
}
```

---

## ğŸ’¡ å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆé‡å¯åè¿˜æ˜¯æ²¡æœ‰æ•°æ®ï¼Ÿ

**A:** å¯èƒ½çš„åŸå› ï¼š

1. **æµè§ˆå™¨ç¼“å­˜** - æŒ‰ Ctrl+Shift+R å¼ºåˆ¶åˆ·æ–°
2. **Mock æœªå¯ç”¨** - æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦æœ‰ `[vite:mock]` æ—¥å¿—
3. **ç¯å¢ƒå˜é‡æœªç”Ÿæ•ˆ** - ç¡®è®¤ `.env.development` ä¸­ `VITE_USE_MOCK=true`
4. **ç«¯å£å†²çª** - ç¡®è®¤æœåŠ¡å™¨è¿è¡Œåœ¨ 5173 ç«¯å£

---

### Q: å¦‚ä½•ç¡®è®¤ Mock API æ­£åœ¨å·¥ä½œï¼Ÿ

**A:** ä¸‰ä¸ªæ–¹æ³•ï¼š

1. **æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—** - æœ‰ `[vite:mock]` å‰ç¼€
2. **æŸ¥çœ‹å“åº”æ—¶é—´** - Mock API < 10msï¼ŒçœŸå® API > 50ms
3. **æŸ¥çœ‹å“åº”æ•°æ®** - Mock æ•°æ®æ˜¯å›ºå®šçš„

---

### Q: å¦‚æœæƒ³è¿æ¥çœŸå®åç«¯æ€ä¹ˆåŠï¼Ÿ

**A:** ä¿®æ”¹ `.env.development`:
```env
VITE_USE_MOCK=false
```
ç„¶åé‡å¯æœåŠ¡å™¨ï¼Œå¹¶ç¡®ä¿åç«¯å·²å¯åŠ¨ã€‚

---

## ğŸ“ ä¸‹ä¸€æ­¥

1. **ç«‹å³é‡å¯å¼€å‘æœåŠ¡å™¨**
2. **æµ‹è¯•æœºåœºåˆ—è¡¨å’Œèˆªç­æœç´¢**
3. **å¦‚æœè¿˜æœ‰é—®é¢˜ï¼ŒæŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯**
4. **æä¾›å…·ä½“çš„é”™è¯¯ä¿¡æ¯ä»¥ä¾¿è¿›ä¸€æ­¥è¯Šæ–­**

---

**å…³é”®æç¤º:** æ‰€æœ‰é…ç½®æ›´æ”¹éƒ½éœ€è¦é‡å¯å¼€å‘æœåŠ¡å™¨æ‰èƒ½ç”Ÿæ•ˆï¼ğŸ”„
