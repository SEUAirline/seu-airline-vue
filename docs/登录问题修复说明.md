# 用户登录问题修复说明

## 问题描述
普通用户无法使用测试账号登录，提示"登录失败，请稍后重试"。

## 问题原因
1. **Mock数据配置不完整**：`mock-data.ts` 中缺少用户登录接口 `/api/auth/login` 的处理逻辑
2. **用户数据缺少密码字段**：Mock用户数据中没有密码字段，无法进行登录验证
3. **Mock插件未统一**：项目中存在两套Mock系统（`mock-data.ts` 和 `mock/user.ts`），但只有 `mock-data.ts` 被启用

## 修复内容

### 1. 更新用户数据结构
在 `mock-data.ts` 中为测试用户添加了密码字段和完整的用户信息：

```typescript
const users: any = {
  '1': {
    id: 1,
    username: 'user123',
    password: '123456',  // 新增密码字段
    email: 'zhangsan@example.com',
    phone: '13800138000',
    realName: '张三',
    vipLevel: 2,
    role: 'user',
    // ... 其他字段
  }
}
```

### 2. 实现登录接口
在 `mock-data.ts` 中添加了 `/api/auth/login` 接口的完整处理逻辑：

- 接收用户名和密码
- 验证用户凭证
- 生成Mock Token
- 返回用户信息（不包含密码）

### 3. 实现注册接口
同时添加了 `/api/auth/register` 接口，支持新用户注册：

- 验证用户名唯一性
- 创建新用户
- 自动登录并返回Token

## 测试账号

### 默认测试账号
- **用户名**: `user123`
- **密码**: `123456`

### 测试步骤
1. 启动开发服务器：`npm run dev`
2. 访问登录页面：http://localhost:5173/login
3. 输入测试账号信息
4. 点击登录按钮
5. 验证登录成功并跳转到首页

## 技术细节

### API响应格式
```json
{
  "code": 200,
  "message": "登录成功",
  "success": true,
  "data": {
    "token": "mock_token_xxx",
    "user": {
      "id": 1,
      "username": "user123",
      "email": "zhangsan@example.com",
      // ... 其他用户信息（不包含密码）
    }
  }
}
```

### 错误处理
- **401**: 用户名或密码错误
- **400**: 注册时用户名已存在
- **500**: 服务器内部错误

## 注意事项

1. **Mock模式**：当前使用Mock数据（`VITE_USE_MOCK=true`），数据存储在内存中
2. **数据持久化**：刷新页面后，登录状态会保存在localStorage中，但其他数据会重置
3. **切换后端**：如需使用真实后端，请修改 `.env.development` 中的 `VITE_USE_MOCK=false`

## 相关文件

- `mock-data.ts` - Mock数据和API处理逻辑
- `src/api/user.ts` - 用户API接口定义
- `src/stores/user.ts` - 用户状态管理
- `src/views/user/LoginPage.vue` - 登录页面组件
- `docs/测试账号说明.md` - 完整的测试账号文档

## 修复时间
2025-11-10

## 修复人员
Cascade AI Assistant
