# 航班管理页面开发说明

**开发时间:** 2025-11-10  
**页面文件:** `src/views/admin/FlightManagePage.vue`  
**状态:** ✅ 已完成

---

## 📋 功能概述

航班管理页面是管理端的核心功能之一，提供完整的航班CRUD（创建、读取、更新、删除）操作，包括航班搜索、筛选、分页、添加、编辑和删除功能。

---

## ✨ 功能特性

### 1. 搜索与筛选
- ✅ **航班号搜索** - 支持模糊搜索
- ✅ **出发机场筛选** - 下拉选择
- ✅ **到达机场筛选** - 下拉选择
- ✅ **状态筛选** - 已排班/延误/已取消
- ✅ **重置搜索** - 一键清空所有筛选条件
- ✅ **回车搜索** - 航班号输入框支持回车搜索

### 2. 航班列表
- ✅ **表格展示** - 清晰的列表布局
- ✅ **航班信息** - 航班号、机型、出发/到达、时间、价格
- ✅ **座位可视化** - 进度条显示可用座位比例
- ✅ **状态标签** - 彩色标签区分不同状态
- ✅ **操作按钮** - 编辑、查看、删除
- ✅ **空状态提示** - 无数据时的友好提示

### 3. 分页功能
- ✅ **智能分页** - 每页10条记录
- ✅ **页码导航** - 最多显示5个页码
- ✅ **上一页/下一页** - 快速翻页
- ✅ **当前页高亮** - 清晰的视觉反馈
- ✅ **记录统计** - 显示当前范围和总数

### 4. 航班操作
- ✅ **添加航班** - 完整的表单验证
- ✅ **编辑航班** - 修改现有航班信息
- ✅ **查看详情** - 只读模式查看
- ✅ **删除航班** - 确认对话框保护
- ✅ **状态限制** - 已取消航班不可删除

### 5. 对话框组件
- ✅ **模态对话框** - FlightDialog组件
- ✅ **三种模式** - 添加/编辑/查看
- ✅ **表单验证** - 必填项标记和验证
- ✅ **自动填充** - 选择机场自动填充城市
- ✅ **响应式布局** - 适配不同屏幕

---

## 🏗️ 组件结构

### 页面组件
```
FlightManagePage.vue
├── AdminLayout (布局容器)
├── 搜索栏 (card)
│   ├── 航班号输入
│   ├── 出发机场选择
│   ├── 到达机场选择
│   └── 操作按钮组
├── 航班列表 (card)
│   ├── 状态筛选
│   ├── 数据表格
│   └── 分页组件
└── FlightDialog (对话框)
    └── 航班表单
```

### 对话框组件
```
FlightDialog.vue
├── 对话框头部
│   ├── 标题（动态）
│   └── 关闭按钮
├── 表单内容
│   ├── 基本信息（航班号、航空公司、机型）
│   ├── 机场信息（出发/到达机场）
│   ├── 时间信息（日期、起飞/到达时间、时长）
│   ├── 价格信息（经济舱价格）
│   ├── 座位信息（经济舱/商务舱/头等舱）
│   └── 状态信息
└── 按钮组
    ├── 取消按钮
    └── 保存按钮
```

---

## 🎨 UI设计

### 色彩方案
```css
主色: #1E3A8A (深蓝色)
辅助色: #3B82F6 (蓝色)
成功: #10B981 (绿色)
警告: #F59E0B (橙色)
危险: #EF4444 (红色)
```

### 状态标签配色
- **已排班:** `bg-blue-100 text-blue-800`
- **延误:** `bg-yellow-100 text-yellow-800`
- **已取消:** `bg-gray-100 text-gray-800`
- **已完成:** `bg-green-100 text-green-800`

### 座位进度条配色
- **充足 (>50%):** 绿色 `bg-green-600`
- **适中 (20-50%):** 黄色 `bg-yellow-600`
- **紧张 (<20%):** 红色 `bg-red-600`

---

## 🔧 技术实现

### 数据结构

#### Flight 类型
```typescript
interface Flight {
  id: string
  flightNo: string
  airline: string
  departureAirport: string
  arrivalAirport: string
  departureCity: string
  arrivalCity: string
  departureTime: string
  arrivalTime: string
  date: string
  duration: string
  price: number
  economySeats: number
  businessSeats: number
  firstClassSeats: number
  status: 'scheduled' | 'delayed' | 'cancelled' | 'completed'
  aircraft?: string
}
```

### 核心功能实现

#### 1. 搜索与筛选
```typescript
const filteredFlights = computed(() => {
  let result = flights.value

  // 航班号筛选
  if (searchForm.value.flightNo) {
    result = result.filter(f => 
      f.flightNo.toLowerCase().includes(searchForm.value.flightNo.toLowerCase())
    )
  }

  // 出发机场筛选
  if (searchForm.value.departureAirport) {
    result = result.filter(f => f.departureAirport === searchForm.value.departureAirport)
  }

  // 到达机场筛选
  if (searchForm.value.arrivalAirport) {
    result = result.filter(f => f.arrivalAirport === searchForm.value.arrivalAirport)
  }

  // 状态筛选
  if (statusFilter.value) {
    result = result.filter(f => f.status === statusFilter.value)
  }

  return result
})
```

#### 2. 分页逻辑
```typescript
// 分页后的航班列表
const paginatedFlights = computed(() => {
  const start = (currentPage.value - 1) * pageSize.value
  const end = start + pageSize.value
  return filteredFlights.value.slice(start, end)
})

// 可见页码（最多5个）
const visiblePages = computed(() => {
  const pages = []
  const maxVisible = 5
  let start = Math.max(1, currentPage.value - Math.floor(maxVisible / 2))
  let end = Math.min(totalPages.value, start + maxVisible - 1)
  
  if (end - start < maxVisible - 1) {
    start = Math.max(1, end - maxVisible + 1)
  }
  
  for (let i = start; i <= end; i++) {
    pages.push(i)
  }
  
  return pages
})
```

#### 3. 座位可视化
```typescript
// 获取可用座位数
function getAvailableSeats(flight: Flight): number {
  return flight.economySeats + flight.businessSeats + flight.firstClassSeats
}

// 获取座位百分比
function getSeatPercentage(flight: Flight): number {
  const available = getAvailableSeats(flight)
  const total = getTotalSeats(flight)
  return Math.round((available / total) * 100)
}

// 获取座位颜色类
function getSeatColorClass(flight: Flight): string {
  const percentage = getSeatPercentage(flight)
  if (percentage > 50) return 'font-medium text-green-600'
  if (percentage > 20) return 'font-medium text-yellow-600'
  return 'font-medium text-red-600'
}
```

#### 4. 对话框管理
```typescript
// 添加航班
function handleAddFlight() {
  selectedFlight.value = null
  dialogMode.value = 'add'
  showDialog.value = true
}

// 编辑航班
function handleEditFlight(flight: Flight) {
  selectedFlight.value = { ...flight }
  dialogMode.value = 'edit'
  showDialog.value = true
}

// 保存航班
function handleSaveFlight(flight: Flight) {
  if (dialogMode.value === 'add') {
    flights.value.unshift(flight)
  } else if (dialogMode.value === 'edit') {
    const index = flights.value.findIndex(f => f.id === flight.id)
    if (index !== -1) {
      flights.value[index] = flight
    }
  }
  showDialog.value = false
}
```

---

## 📁 文件结构

```
seu-airline-vue/
├── src/
│   ├── views/admin/
│   │   └── FlightManagePage.vue       ✅ 航班管理页面 (499行)
│   ├── components/admin/
│   │   └── FlightDialog.vue           ✅ 航班对话框 (416行)
│   ├── types/
│   │   └── flight.ts                  ✅ 航班类型定义
│   └── api/
│       └── mock.ts                    ✅ Mock API
└── docs/
    └── 航班管理页面开发说明.md         ✅ 本文档
```

**总代码量:** 约915行

---

## 🧪 测试说明

### 访问方式
1. 登录管理员账号：`admin / admin123`
2. 点击侧边栏"航班管理"
3. 或直接访问：`/admin/flights`

### 功能测试

#### 1. 搜索功能测试
**测试步骤：**
1. 在航班号输入框输入 "CA"
2. 点击搜索按钮或按回车
3. **预期结果:** 只显示包含"CA"的航班

#### 2. 筛选功能测试
**测试步骤：**
1. 选择出发机场 "北京首都 (PEK)"
2. 选择到达机场 "上海浦东 (PVG)"
3. 点击搜索
4. **预期结果:** 只显示北京到上海的航班

#### 3. 状态筛选测试
**测试步骤：**
1. 在状态下拉框选择"延误"
2. **预期结果:** 只显示延误状态的航班

#### 4. 重置搜索测试
**测试步骤：**
1. 设置多个筛选条件
2. 点击"重置"按钮
3. **预期结果:** 所有筛选条件清空，显示全部航班

#### 5. 添加航班测试
**测试步骤：**
1. 点击"添加航班"按钮
2. 填写所有必填项
3. 点击"添加航班"按钮
4. **预期结果:** 对话框关闭，新航班出现在列表顶部

#### 6. 编辑航班测试
**测试步骤：**
1. 点击某个航班的编辑按钮
2. 修改航班信息
3. 点击"保存修改"
4. **预期结果:** 对话框关闭，航班信息已更新

#### 7. 查看详情测试
**测试步骤：**
1. 点击某个航班的查看按钮
2. **预期结果:** 显示只读的航班详情，所有输入框禁用

#### 8. 删除航班测试
**测试步骤：**
1. 点击某个航班的删除按钮
2. 在确认对话框点击"确定"
3. **预期结果:** 航班从列表中移除

#### 9. 分页测试
**测试步骤：**
1. 点击页码按钮
2. 点击上一页/下一页按钮
3. **预期结果:** 正确显示对应页的数据

#### 10. 响应式测试
**测试步骤：**
1. 调整浏览器窗口大小
2. **预期结果:** 布局自适应，移动端友好

---

## 📊 数据流程

### 添加航班流程
```
用户点击"添加航班"
  ↓
打开对话框（add模式）
  ↓
用户填写表单
  ↓
点击"添加航班"
  ↓
表单验证
  ↓
生成航班ID
  ↓
emit('save', flight)
  ↓
handleSaveFlight()
  ↓
flights.unshift(flight)
  ↓
关闭对话框
```

### 编辑航班流程
```
用户点击"编辑"按钮
  ↓
打开对话框（edit模式）
  ↓
填充现有数据
  ↓
用户修改表单
  ↓
点击"保存修改"
  ↓
表单验证
  ↓
emit('save', flight)
  ↓
handleSaveFlight()
  ↓
更新flights数组
  ↓
关闭对话框
```

---

## 💡 技术亮点

### 1. 计算属性优化
使用 `computed` 实现响应式筛选和分页，性能优秀：
```typescript
const filteredFlights = computed(() => {
  // 多条件筛选逻辑
})

const paginatedFlights = computed(() => {
  // 分页逻辑
})
```

### 2. 组件通信
父子组件通过 `v-model` 和 `emit` 通信：
```vue
<!-- 父组件 -->
<FlightDialog 
  v-model="showDialog" 
  :flight="selectedFlight"
  :mode="dialogMode"
  @save="handleSaveFlight"
/>
```

### 3. 表单验证
HTML5原生验证 + 自定义逻辑：
```vue
<input 
  v-model="formData.flightNo" 
  type="text" 
  required
  placeholder="例如: CA1234"
>
```

### 4. 状态管理
使用 `ref` 和 `computed` 管理复杂状态：
```typescript
const flights = ref<Flight[]>([])
const searchForm = ref({ ... })
const statusFilter = ref('')
const currentPage = ref(1)
```

### 5. 用户体验
- 回车搜索
- 确认删除
- 加载提示
- 空状态提示
- 禁用状态

---

## 🎯 待完成功能

### 后端集成
- [ ] 连接真实API
- [ ] 实现航班CRUD接口
- [ ] 添加加载状态
- [ ] 错误处理和提示

### 功能增强
- [ ] 批量操作（批量删除、批量修改状态）
- [ ] 导出功能（Excel/CSV）
- [ ] 高级筛选（价格区间、时间区间）
- [ ] 排序功能（按价格、时间、座位数排序）
- [ ] 航班复制功能

### 性能优化
- [ ] 虚拟滚动（大数据量）
- [ ] 防抖搜索
- [ ] 懒加载
- [ ] 缓存机制

---

## 📚 相关资源

- **HTML原型:** `SEUAirline.github.io/pages/admin/flights.html`
- **Vue 3文档:** https://cn.vuejs.org/
- **TypeScript文档:** https://www.typescriptlang.org/

---

## 📊 完成度

| 功能模块 | 状态 | 完成度 |
|---------|------|--------|
| 搜索筛选 | ✅ | 100% |
| 航班列表 | ✅ | 100% |
| 分页功能 | ✅ | 100% |
| 添加航班 | ✅ | 100% |
| 编辑航班 | ✅ | 100% |
| 查看详情 | ✅ | 100% |
| 删除航班 | ✅ | 100% |
| 对话框组件 | ✅ | 100% |
| 响应式设计 | ✅ | 100% |
| API集成 | 🟡 | 50% (Mock) |

**总体完成度: 95%** ✅

---

## 🚀 下一步

1. **测试当前功能**
   ```bash
   npm run dev
   # 访问 /admin/flights
   ```

2. **继续开发其他页面**
   - 订单管理页面
   - 用户管理页面
   - 机场管理页面

3. **后端API对接**
   - 实现真实的CRUD接口
   - 添加错误处理
   - 实现数据持久化

---

**开发者:** SEUAirline 开发团队  
**最后更新:** 2025-11-10  
**文档版本:** v1.0
