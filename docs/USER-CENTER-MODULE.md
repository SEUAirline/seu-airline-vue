# 个人中心模块开发文档

**开发时间:** 2025-11-06 22:08  
**状态:** ✅ 开发完成，待测试

---

## 📋 功能概览

### 已完成的页面

1. **个人中心首页** (`/user/profile`)
   - 用户信息展示（头像、昵称、积分、会员等级）
   - 快捷入口（订单、旅客、消息、设置）
   - 订单统计（待支付、已支付、已完成、已取消）
   - 最近订单列表

2. **订单管理页面** (`/user/orders`)
   - 订单列表展示
   - 订单状态筛选（全部/待支付/已支付/已完成/已取消）
   - 订单详情查看
   - 立即支付功能
   - 取消订单功能
   - 分页功能

3. **常用旅客管理** (`/user/passengers`)
   - 旅客列表展示
   - 添加旅客
   - 编辑旅客信息
   - 删除旅客
   - 设置默认旅客

4. **账号设置** (`/user/settings`)
   - 基本信息编辑（昵称、性别、生日、手机、邮箱）
   - 修改密码
   - 头像更换（UI已实现，功能待完善）

---

## 🎯 Mock API 列表

### 用户相关

```typescript
// 获取用户信息
GET /api/user/profile
Response: {
  id: 1,
  username: 'user123',
  nickname: '张三',
  email: 'zhangsan@example.com',
  phone: '13800138000',
  avatar: 'https://...',
  gender: 'male',
  birthday: '1990-01-01',
  idCard: '320123199001011234',
  createTime: '2024-01-01 10:00:00',
  points: 1580,
  level: 'gold'
}

// 更新用户信息
PUT /api/user/profile
Body: {
  nickname: string,
  gender: 'male' | 'female',
  birthday: string,
  phone: string,
  email: string
}

// 修改密码
PUT /api/user/password
Body: {
  oldPassword: string,
  newPassword: string
}
```

### 常用旅客

```typescript
// 获取旅客列表
GET /api/passengers
Response: Array<{
  id: string,
  userId: number,
  name: string,
  idType: 'ID_CARD' | 'PASSPORT' | 'OTHER',
  idNumber: string,
  phone: string,
  email: string,
  passengerType: 'adult' | 'child' | 'infant',
  isDefault: boolean
}>

// 添加旅客
POST /api/passengers
Body: {
  name: string,
  idType: string,
  idNumber: string,
  phone: string,
  email?: string,
  passengerType: string,
  isDefault: boolean
}

// 更新旅客
PUT /api/passengers/:id
Body: { ...旅客信息 }

// 删除旅客
DELETE /api/passengers/:id
```

### 订单相关

```typescript
// 获取用户订单列表
GET /api/user/orders?status=xxx&page=1&pageSize=10
Query Parameters:
  - status: 'all' | '0' | '1' | '2' | '3' (可选)
  - page: number (默认1)
  - pageSize: number (默认10)

Response: {
  list: Array<Order>,
  total: number,
  page: number,
  pageSize: number
}
```

---

## 🗂️ 文件结构

```
src/
├── views/user/
│   ├── ProfilePage.vue          # 个人中心首页
│   ├── OrdersPage.vue           # 订单管理
│   ├── PassengersPage.vue       # 常用旅客
│   └── SettingsPage.vue         # 账号设置
├── router/
│   └── index.ts                 # 路由配置（已更新）
└── mock-data.ts                 # Mock API（已扩展）
```

---

## 🎨 页面特性

### 1. 个人中心首页

**特点:**
- 渐变色背景的用户信息卡片
- 会员等级徽章显示
- 4个快捷入口卡片（带图标和统计数字）
- 订单统计面板（4种状态）
- 最近3个订单展示
- 响应式布局

**交互:**
- 点击快捷入口跳转到对应页面
- 点击订单卡片查看订单详情
- "查看全部"链接跳转到订单管理页面

---

### 2. 订单管理页面

**特点:**
- 5个标签页筛选（全部/待支付/已支付/已完成/已取消）
- 标签显示订单数量
- 订单卡片展示航班信息（出发/到达时间和城市）
- 订单状态彩色标签
- 分页功能

**交互:**
- 切换标签筛选订单
- 点击"立即支付"跳转到支付页面
- 点击"查看详情"查看订单详情
- 点击"取消订单"取消待支付订单
- 分页切换

**订单状态:**
- 0: 待支付（橙色）
- 1: 已支付（绿色）
- 2: 已完成（蓝色）
- 3: 已取消（灰色）

---

### 3. 常用旅客管理

**特点:**
- 旅客卡片展示（姓名、证件、联系方式）
- 默认旅客标签
- 旅客类型标签（成人/儿童/婴儿）
- 添加/编辑弹窗表单
- 删除确认

**交互:**
- 点击"添加旅客"打开弹窗
- 点击"编辑"编辑旅客信息
- 点击"删除"删除旅客（默认旅客不可删除）
- 表单验证（必填项）

**表单字段:**
- 姓名（必填）
- 证件类型（必填，下拉选择）
- 证件号码（必填）
- 旅客类型（必填，下拉选择）
- 手机号（必填）
- 邮箱（选填）
- 设为默认（复选框）

---

### 4. 账号设置

**特点:**
- 2个标签页（基本信息/修改密码）
- 头像展示和更换按钮
- 表单验证
- 保存状态提示

**基本信息:**
- 头像（展示，更换功能待完善）
- 昵称
- 性别（单选）
- 生日（日期选择）
- 手机号
- 邮箱

**修改密码:**
- 当前密码
- 新密码（6-20位）
- 确认新密码
- 密码一致性验证

---

## 🚀 测试步骤

### 步骤1: 重启服务器

```bash
# 停止当前服务器
Ctrl+C

# 重新启动
npm run dev
```

### 步骤2: 访问个人中心

```
http://localhost:5173/user/profile
```

**预期结果:**
- ✅ 显示用户信息（张三、user123）
- ✅ 显示积分：1580
- ✅ 显示会员等级：金卡
- ✅ 显示4个快捷入口
- ✅ 显示订单统计
- ✅ 显示最近订单（如果有）

---

### 步骤3: 测试订单管理

1. **点击"我的订单"快捷入口**
   - 应该跳转到 `/user/orders`
   - 显示订单列表

2. **测试标签筛选**
   - 点击"待支付"标签
   - 应该只显示待支付订单

3. **测试支付功能**
   - 点击"立即支付"按钮
   - 应该跳转到支付页面

4. **测试取消订单**
   - 点击"取消订单"
   - 确认后订单状态变为"已取消"

---

### 步骤4: 测试常用旅客

1. **查看旅客列表**
   - 访问 `/user/passengers`
   - 应该显示2个默认旅客（张三、李四）

2. **添加旅客**
   - 点击"添加旅客"
   - 填写表单
   - 点击"保存"
   - 旅客列表应该更新

3. **编辑旅客**
   - 点击"编辑"按钮
   - 修改信息
   - 点击"保存"
   - 信息应该更新

4. **删除旅客**
   - 点击"删除"按钮（非默认旅客）
   - 确认删除
   - 旅客应该从列表中移除

---

### 步骤5: 测试账号设置

1. **编辑基本信息**
   - 访问 `/user/settings`
   - 修改昵称
   - 点击"保存"
   - 应该显示"保存成功"

2. **修改密码**
   - 切换到"修改密码"标签
   - 填写当前密码和新密码
   - 点击"确认修改"
   - 应该显示"密码修改成功"

---

## 📊 终端日志示例

**正常的API调用日志:**

```
📡 拦截请求: /api/user/profile {}
📡 拦截请求: /api/user/orders { page: '1', pageSize: '100' }
📡 拦截请求: /api/messages/unread-count {}
📡 拦截请求: /api/passengers {}
📡 拦截请求: /api/user/profile {}
```

---

## ✅ 功能检查清单

### 个人中心首页
- [ ] 用户信息正确显示
- [ ] 积分和等级正确显示
- [ ] 快捷入口可点击跳转
- [ ] 订单统计数据正确
- [ ] 最近订单列表显示

### 订单管理
- [ ] 订单列表正确显示
- [ ] 标签筛选功能正常
- [ ] 立即支付跳转正确
- [ ] 取消订单功能正常
- [ ] 分页功能正常

### 常用旅客
- [ ] 旅客列表正确显示
- [ ] 添加旅客功能正常
- [ ] 编辑旅客功能正常
- [ ] 删除旅客功能正常
- [ ] 表单验证正常

### 账号设置
- [ ] 基本信息显示正确
- [ ] 保存基本信息功能正常
- [ ] 修改密码功能正常
- [ ] 表单验证正常

---

## 🎯 后续优化建议

### 1. 功能增强

- [ ] **头像上传功能**
  - 添加图片上传组件
  - 图片裁剪功能
  - 上传到服务器或OSS

- [ ] **订单详情页面**
  - 完整的订单信息展示
  - 退票/改签功能
  - 发票下载

- [ ] **消息中心**
  - 消息列表
  - 消息分类
  - 已读/未读管理

### 2. 用户体验

- [ ] **加载动画优化**
  - 骨架屏
  - 更流畅的过渡动画

- [ ] **错误处理**
  - 更友好的错误提示
  - 网络错误重试机制

- [ ] **表单优化**
  - 实时验证
  - 更详细的错误提示
  - 自动保存草稿

### 3. 性能优化

- [ ] **数据缓存**
  - 用户信息缓存
  - 订单列表缓存

- [ ] **懒加载**
  - 图片懒加载
  - 路由懒加载优化

---

## 🐛 已知问题

1. **头像上传功能未实现**
   - 状态：UI已完成，功能待开发
   - 优先级：中

2. **订单详情页面缺失**
   - 状态：路由已配置，页面待创建
   - 优先级：高

3. **消息中心功能简单**
   - 状态：仅有基础API，页面待完善
   - 优先级：中

---

## 📝 开发总结

### 已完成

✅ **4个核心页面**
- 个人中心首页
- 订单管理
- 常用旅客
- 账号设置

✅ **完整的Mock API**
- 用户信息相关（获取、更新、修改密码）
- 常用旅客相关（增删改查）
- 订单列表相关（筛选、分页）

✅ **路由配置**
- 所有页面路由已配置
- 需要登录验证

✅ **响应式设计**
- 适配桌面和移动端
- 使用 Tailwind CSS

### 技术栈

- **框架:** Vue 3 + TypeScript
- **路由:** Vue Router 4
- **样式:** Tailwind CSS
- **HTTP:** Axios
- **Mock:** 自定义 Mock 中间件

---

## 🎉 下一步

1. **测试所有功能**
   - 按照测试步骤逐一验证
   - 记录发现的问题

2. **修复问题**
   - 修复测试中发现的bug
   - 优化用户体验

3. **完善功能**
   - 实现头像上传
   - 创建订单详情页面
   - 完善消息中心

4. **准备后端对接**
   - 整理API文档
   - 准备真实后端接口对接

---

**现在请重启服务器，开始测试个人中心模块！** 🚀
