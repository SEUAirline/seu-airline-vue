# 订单管理页面开发说明

**开发时间:** 2025-11-10  
**页面文件:** `src/views/admin/OrderManagePage.vue`  
**状态:** ✅ 已完成

---

## 📋 功能概述

订单管理页面是管理端的核心功能之一，提供完整的订单查看、搜索、筛选和管理功能，帮助管理员高效处理客户订单。

---

## ✨ 功能特性

### 1. 搜索与筛选
- ✅ **订单号搜索** - 支持模糊搜索
- ✅ **客户姓名搜索** - 支持模糊搜索
- ✅ **航班号搜索** - 支持模糊搜索
- ✅ **状态筛选** - 待支付/已支付/已出票/已取消/已退款
- ✅ **重置搜索** - 一键清空所有筛选条件
- ✅ **回车搜索** - 所有输入框支持回车搜索

### 2. 订单列表
- ✅ **表格展示** - 清晰的列表布局
- ✅ **订单信息** - 订单号、客户、航班、日期、金额、状态
- ✅ **状态标签** - 彩色标签区分不同状态
- ✅ **电话脱敏** - 自动隐藏中间4位
- ✅ **时间格式化** - 友好的时间显示
- ✅ **空状态提示** - 无数据时的友好提示

### 3. 分页功能
- ✅ **智能分页** - 每页10条记录
- ✅ **页码导航** - 最多显示5个页码
- ✅ **上一页/下一页** - 快速翻页
- ✅ **当前页高亮** - 清晰的视觉反馈
- ✅ **记录统计** - 显示当前范围和总数

### 4. 订单操作
- ✅ **查看详情** - 完整的订单详情对话框
- ✅ **查看客票** - 已出票订单可查看客票
- ✅ **提醒支付** - 待支付订单可发送提醒
- ✅ **取消订单** - 待支付/已支付订单可取消
- ✅ **联系客户** - 显示客户联系方式

### 5. 订单详情对话框
- ✅ **订单信息** - 订单号、状态、时间、金额
- ✅ **航班信息** - 航班号、出发/到达、舱位
- ✅ **乘客信息** - 姓名、身份证、类型
- ✅ **联系人信息** - 姓名、电话、邮箱
- ✅ **快捷操作** - 提醒支付、查看客票、取消订单

---

## 🏗️ 组件结构

### 页面组件
```
OrderManagePage.vue
├── AdminLayout (布局容器)
├── 搜索栏 (card)
│   ├── 订单号输入
│   ├── 客户姓名输入
│   ├── 航班号输入
│   └── 操作按钮组
├── 订单列表 (card)
│   ├── 状态筛选
│   ├── 数据表格
│   └── 分页组件
└── OrderDetailDialog (对话框)
    ├── 订单信息
    ├── 航班信息
    ├── 乘客信息
    └── 联系人信息
```

### 对话框组件
```
OrderDetailDialog.vue
├── 对话框头部
│   ├── 标题
│   └── 关闭按钮
├── 订单信息区域
│   ├── 订单号、状态
│   ├── 下单时间、支付时间
│   └── 支付方式、订单金额
├── 航班信息区域
│   ├── 出发/到达城市
│   ├── 航班号、舱位
│   └── 出发日期、单价
├── 乘客信息区域
│   └── 乘客列表
├── 联系人信息区域
│   └── 姓名、电话、邮箱
└── 操作按钮组
    ├── 提醒支付
    ├── 查看客票
    ├── 取消订单
    └── 关闭
```

---

## 🎨 UI设计

### 色彩方案
```css
主色: #1E3A8A (深蓝色)
辅助色: #3B82F6 (蓝色)
成功: #10B981 (绿色)
警告: #F59E0B (橙色)
危险: #EF4444 (红色)
```

### 状态标签配色
- **待支付:** `bg-yellow-100 text-yellow-800`
- **已支付:** `bg-blue-100 text-blue-800`
- **已出票:** `bg-green-100 text-green-800`
- **已取消:** `bg-gray-100 text-gray-800`
- **已退款:** `bg-purple-100 text-purple-800`

### 操作按钮配色
- **查看详情:** 蓝色 `text-blue-900`
- **查看客票:** 绿色 `text-green-600`
- **提醒支付:** 黄色 `text-yellow-600`
- **取消订单:** 红色 `text-red-600`
- **联系客户:** 灰色 `text-gray-600`

---

## 🔧 技术实现

### 核心功能实现

#### 1. 搜索与筛选
```typescript
const filteredOrders = computed(() => {
  let result = orders.value

  // 订单号筛选
  if (searchForm.value.orderNo) {
    result = result.filter(o => 
      o.orderNo.toLowerCase().includes(searchForm.value.orderNo.toLowerCase())
    )
  }

  // 客户姓名筛选
  if (searchForm.value.customerName) {
    result = result.filter(o => 
      o.contactName?.toLowerCase().includes(searchForm.value.customerName.toLowerCase())
    )
  }

  // 航班号筛选
  if (searchForm.value.flightNo) {
    result = result.filter(o => 
      o.flightNo.toLowerCase().includes(searchForm.value.flightNo.toLowerCase())
    )
  }

  // 状态筛选
  if (statusFilter.value) {
    result = result.filter(o => o.status === statusFilter.value)
  }

  return result
})
```

#### 2. 电话脱敏
```typescript
function formatPhone(phone?: string): string {
  if (!phone) return '-'
  return phone.replace(/(\d{3})\d{4}(\d{4})/, '$1****$2')
}
// 示例: 13812345678 -> 138****5678
```

#### 3. 时间格式化
```typescript
function formatDateTime(datetime: string): string {
  if (!datetime) return '-'
  return datetime.replace('T', ' ').substring(0, 19)
}
// 示例: 2023-05-26T14:30:22 -> 2023-05-26 14:30:22
```

#### 4. 条件操作按钮
```vue
<!-- 查看客票 - 仅已出票订单显示 -->
<button v-if="order.status === 'completed'">
  <i class="fas fa-ticket-alt"></i>
</button>

<!-- 提醒支付 - 仅待支付订单显示 -->
<button v-if="order.status === 'pending'">
  <i class="fas fa-bell"></i>
</button>

<!-- 取消订单 - 仅待支付/已支付订单显示 -->
<button v-if="['pending', 'paid'].includes(order.status)">
  <i class="fas fa-times-circle"></i>
</button>
```

#### 5. 订单详情对话框
```typescript
function handleViewOrder(order: Order) {
  selectedOrder.value = order
  showDetailDialog.value = true
}
```

---

## 📁 文件结构

```
seu-airline-vue/
├── src/
│   ├── views/admin/
│   │   └── OrderManagePage.vue        ✅ 订单管理页面 (440行)
│   ├── components/admin/
│   │   └── OrderDetailDialog.vue      ✅ 订单详情对话框 (289行)
│   ├── types/
│   │   └── order.ts                   ✅ 订单类型定义
│   └── api/
│       └── admin.ts                   ✅ 管理端API
└── docs/
    └── 订单管理页面开发说明.md         ✅ 本文档
```

**总代码量:** 约729行

---

## 🧪 测试说明

### 访问方式
1. 登录管理员账号：`admin / admin123`
2. 点击侧边栏"订单管理"
3. 或直接访问：`/admin/orders`

### 功能测试

#### 1. 搜索功能测试
**测试步骤：**
1. 在订单号输入框输入订单号
2. 点击搜索按钮或按回车
3. **预期结果:** 只显示匹配的订单

#### 2. 筛选功能测试
**测试步骤：**
1. 输入客户姓名
2. 输入航班号
3. 点击搜索
4. **预期结果:** 显示同时满足条件的订单

#### 3. 状态筛选测试
**测试步骤：**
1. 在状态下拉框选择"待支付"
2. **预期结果:** 只显示待支付状态的订单

#### 4. 重置搜索测试
**测试步骤：**
1. 设置多个筛选条件
2. 点击"重置"按钮
3. **预期结果:** 所有筛选条件清空，显示全部订单

#### 5. 查看详情测试
**测试步骤：**
1. 点击某个订单的查看按钮
2. **预期结果:** 显示订单详情对话框，包含完整信息

#### 6. 提醒支付测试
**测试步骤：**
1. 找到待支付订单
2. 点击提醒支付按钮
3. 确认操作
4. **预期结果:** 显示提醒已发送

#### 7. 取消订单测试
**测试步骤：**
1. 找到待支付或已支付订单
2. 点击取消订单按钮
3. 确认操作
4. **预期结果:** 订单状态变为已取消

#### 8. 分页测试
**测试步骤：**
1. 点击页码按钮
2. 点击上一页/下一页按钮
3. **预期结果:** 正确显示对应页的数据

#### 9. 联系客户测试
**测试步骤：**
1. 点击联系客户按钮
2. **预期结果:** 显示客户联系信息

#### 10. 响应式测试
**测试步骤：**
1. 调整浏览器窗口大小
2. **预期结果:** 布局自适应，移动端友好

---

## 📊 数据流程

### 查看订单详情流程
```
用户点击"查看详情"
  ↓
handleViewOrder(order)
  ↓
selectedOrder.value = order
  ↓
showDetailDialog.value = true
  ↓
OrderDetailDialog显示
  ↓
展示完整订单信息
```

### 取消订单流程
```
用户点击"取消订单"
  ↓
确认对话框
  ↓
用户确认
  ↓
order.status = 'cancelled'
  ↓
显示成功提示
  ↓
列表自动更新
```

---

## 💡 技术亮点

### 1. 计算属性优化
使用 `computed` 实现响应式筛选和分页：
```typescript
const filteredOrders = computed(() => {
  // 多条件筛选逻辑
})

const paginatedOrders = computed(() => {
  // 分页逻辑
})
```

### 2. 数据脱敏
保护用户隐私，电话号码自动脱敏：
```typescript
function formatPhone(phone?: string): string {
  if (!phone) return '-'
  return phone.replace(/(\d{3})\d{4}(\d{4})/, '$1****$2')
}
```

### 3. 条件渲染
根据订单状态显示不同操作按钮：
```vue
<button v-if="order.status === 'completed'">查看客票</button>
<button v-if="order.status === 'pending'">提醒支付</button>
<button v-if="['pending', 'paid'].includes(order.status)">取消订单</button>
```

### 4. 组件通信
父子组件通过 `v-model` 通信：
```vue
<!-- 父组件 -->
<OrderDetailDialog 
  v-model="showDetailDialog" 
  :order="selectedOrder"
/>

<!-- 子组件 -->
const emit = defineEmits<{
  'update:modelValue': [value: boolean]
}>()
```

### 5. 用户体验
- 回车搜索
- 确认操作
- 电话脱敏
- 时间格式化
- 空状态提示

---

## 🎯 待完成功能

### 后端集成
- [ ] 连接真实API
- [ ] 实现订单状态更新接口
- [ ] 添加加载状态
- [ ] 错误处理和提示

### 功能增强
- [ ] 批量操作（批量取消、批量导出）
- [ ] 导出功能（Excel/CSV）
- [ ] 高级筛选（日期范围、金额范围）
- [ ] 排序功能（按时间、金额排序）
- [ ] 订单统计（今日订单、本月订单）
- [ ] 实际发送支付提醒（短信/邮件）
- [ ] 实际查看客票（PDF生成）
- [ ] 退款功能

### 性能优化
- [ ] 虚拟滚动（大数据量）
- [ ] 防抖搜索
- [ ] 懒加载
- [ ] 缓存机制

---

## 📚 相关资源

- **HTML原型:** `SEUAirline.github.io/pages/admin/orders.html`
- **Vue 3文档:** https://cn.vuejs.org/
- **TypeScript文档:** https://www.typescriptlang.org/

---

## 📊 完成度

| 功能模块 | 状态 | 完成度 |
|---------|------|--------|
| 搜索筛选 | ✅ | 100% |
| 订单列表 | ✅ | 100% |
| 分页功能 | ✅ | 100% |
| 查看详情 | ✅ | 100% |
| 提醒支付 | ✅ | 100% |
| 取消订单 | ✅ | 100% |
| 联系客户 | ✅ | 100% |
| 详情对话框 | ✅ | 100% |
| 响应式设计 | ✅ | 100% |
| API集成 | 🟡 | 50% (Mock) |

**总体完成度: 95%** ✅

---

## 🚀 下一步

1. **测试当前功能**
   ```bash
   npm run dev
   # 访问 /admin/orders
   ```

2. **继续开发其他页面**
   - 用户管理页面
   - 机场管理页面
   - 系统设置页面

3. **后端API对接**
   - 实现真实的订单管理接口
   - 添加错误处理
   - 实现数据持久化

---

**开发者:** SEUAirline 开发团队  
**最后更新:** 2025-11-10  
**文档版本:** v1.0
